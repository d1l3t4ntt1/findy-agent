package issuecredential

import (
	"testing"

	"github.com/findy-network/findy-agent/agent/aries"
	"github.com/findy-network/findy-agent/agent/didcomm"
	"github.com/findy-network/findy-agent/agent/pltype"
	"github.com/findy-network/findy-agent/std/decorator"
	"github.com/stretchr/testify/assert"
)

var offerData = `  {
    "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/issue-credential/1.0/offer-credential",
    "@id": "3dc323d4-17ec-4a4a-9d3a-uc903e94d253b",
    "~thread": {},
    "credential_preview": {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/issue-credential/1.0/credential-preview",
      "attributes": [
        { "name": "name", "value": "Alice Smith" },
        { "name": "date", "value": "2018-05-28" },
        { "name": "degree", "value": "Maths" },
        { "name": "age", "value": "24" }
      ]
    },
    "offers~attach": [
      {
        "@id": "libindy-cred-offer-0",
        "mime-type": "application/json",
        "data": {
          "base64": "eyJzY2hlbWFfaWQiOiAiU2F6Z1ZyZVVYdHdGNFpCd0F4VVB3VToyOmRlZ3JlZSBzY2hlbWE6MTUuNDMuOTMiLCAiY3JlZF9kZWZfaWQiOiAiU2F6Z1ZyZVVYdHdGNFpCd0F4VVB3VTozOkNMOjI1OmRlZmF1bHQiLCAia2V5X2NvcnJlY3RuZXNzX3Byb29mIjogeyJjIjogIjQwNTg1ODA1MTkyNjg1NTgwNDAxNzQwMDkxODI0MTM1MjkzMjY0NTQ0MTg0OTQ2MjA0MjY5OTc4Mjc4MTA5NDYxMzkyOTk1ODk2NyIsICJ4el9jYXAiOiAiOTAzNTE3NTE3ODI5NDMyNTI3ODIxOTY2Nzc4NDM5MTYzODY5NjMwNjgzNjk5MDgxMTkzMTg1OTAyNTk5MTAzNjM2ODQyMzMzNjI2MTk4NjA1MjM4NDc5OTgxNTUxNzY5MTYxNjMyNjY1MzgyNzMwMjAzNzI5Njg2NzAxNTc3MTc1MzEwNTg4NDkzMzM2MDgwNzAzNzE4ODAzNTA1OTcxNTQwNzY3ODYyMTY1NTgzMTI1NjcwNDAyNjI2NzUyMjgxNDE1MDczMTIyMzIzNDM4OTU4NjY2OTAyNjgwMzIwODczMDkzNTc1NDkyOTQxOTk4NjM3NjQ3OTQ0NzM5MTg3MzY4NzYxODc3ODQwMzYyMzg3NDk3MzkzMDcyMzAxNzA3MzQ4NzgxNjUxMjYzODE3NzY5MjE5OTk5MTg0NjM4MDA5MDE2NzMyMzU1Mzc0NjU4ODQ2NzAwNTI2NjgwNjMxMDk5ODcwMzM3NzUxNjc1MTI1MTU5Nzg1OTQ5NTAyNTYyNTAyMjY1Mjc3MTE4MzYyMzQ1OTkwNTIyMTQwMTcxNTg2Mzk5NjI4MjUxNzU2MTE3Mzg2Njc0NTgwNjcwMDQ4MjY5ODIzNzYxODI1Mjk1NjE3NTAyNzM4NTk5MjU5MzIzOTY2NDgxMTIzNjAxMzA3MjUxMjY1OTEyNjgwNTEwNjk0OTg1Mjc3MjQ0NTYyNTA3ODM5NTMwMjQ1NzkxMDIxOTIyNTg2NjExNzI4ODM2MzUwNzMwNTY2OTA5NDY4NjQ3NjM0NzcyMTIyOTI4NjUxNTY5ODI4MzA3NDExNjAzODc0NDE5Nzg0MDQ4OTc3NTMxOTQ3Njg0MDYwODY4NDYyNzE3MTQzMjAxNzc4NzM1MjUxNTk1Mzk2MjMyMDk0NzExNzY4NDY3MTA1MjU2OTU4NjQ2NCIsICJ4cl9jYXAiOiBbWyJtYXN0ZXJfc2VjcmV0IiwgIjg4Mzk4MjE4MjUzMDIwNzIwNTMxNDIxNTI5MTkzMDY4MjEzMjY3MTE5ODQ5OTkxMzA1MzIyODI5ODI5MDcxMzMxMjc4NTc2NTM2OTkzNjYxODE1Mjc3Mzk2OTI2NjUyNjY0NTE1MTY0NTU3Njk2NzI2MDc2NjY5NTc4MjAzMjMxNTk3NTEzNTkzODE4NjQ0MTM3NDY4MzI2MzAyMDI3NTUyMDc1MzgzNjk2Njg3NTgzMDk3NzM3MjMzNzkxODU4NjYzOTYwODY5NDMwODEwNDIwNzA5ODY3OTMyMzg2MjY3MzY5OTc2NjQ2OTE1NTk2ODMxMTgyNDYyNTM2MTk3MTU5OTUyMTcyMDUwMjA2NTA0MTk5Mjg3MTIxOTA0MTAwMDQ4OTQ1ODU0NDE0NjM1NDQxOTUzOTc1NjAyNDA3NDIyNDIwMzk5NzU3MzU0ODA2NjU0OTA5NzY1MDY4Mjg3MzkxMzc1MDYxNjEyMDk2MTE1NDUyOTEyMzUwNzMxNzczMDQxOTIyMjkxNDA5Mjk1NDY5OTUwODM1ODkxNDU3MDEwNDg2NzU0ODc0MzIwMjk0ODU5Njc5MzAxNDM1ODc5ODc1MDMyMDQ5OTE0MDcxNzUyNzUzNjk0MzM1OTcwMzYzNDc3ODk1NjAxNjA5NTg1ODA3NDc2NzM5MTQ0NTkxODU3ODExMDA1NjI0MDExMjkxNjMwMTQ0MTQ3MjU5MzU0MzIyNTA2NTc0OTk4ODQ1ODk4NDMzMzczNjgwNTA5MjI3MzM0NzU2MDMyMDUxMTUzOTU2NDg5NjYzMzczODUwNDE4NzU2MjQ4MTQzMTcxMjkzODI5Mzg4OTE2Nzg5ODQwMzY5OTExMDQ2MjE3NjY1NDYyNjkyMjg0MDQzODA5OTczMjcxMDAzMTg4NTkyNTA3MzQ3MjEiXSwgWyJkYXRlIiwgIjU0MzQyMTE0MDc3NzM3MTgxMzY4NzQ2NjU1MDU0MTMwOTAzMzcxNzc5MDE0OTg1MjU2NDUxNzg0MjgwNDA3ODE1MTgzNTQ5NjU4MjM3ODA1NjI1MjQyNzUxOTAxODk5NzA0MTkxMDA1NDczNTg0MzQyMzM4NzI5MTU4MDk5MTc3OTIyNDkwMDY0NDE3NTA5MzY2MTQwNDM0MDU5MzM1MzEwNjI3MDA5MTMyMDk4NjEwNzIyNTQ0ODIwMjQyMTQ2OTYzNjMzNzkzNTE0MzAxNDI4NzAzMTA1NjgwNDkyNDY1ODkyOTcwNTg1OTUzMjAyMzIwMjM5NzY1NzI4MjMyMjQxNzE0NzgxODM0ODI2OTMyNDcyNTM2NzAwODIwMzY1MzM1Mzc2ODI3MjE3MTUxMDI2NjE1NjE0MzUwMzYwMTg5NzY2MzIyNzk0MTI5NTcyNjE2NDc2MzAwMDAzMjU3ODUzMDE3NzIyNjQ1NzI1NTc4MzczODQyMjc5MjQ5MjU5NDc1MDE1NDI1NDQ5NjI5NTE0MjAzNzUwMDk5MDY1MDU4MjE5MTIwOTcwNDEwNTc1Nzc1NjM1OTMxOTgxNDAwMjkwNTcwNjc1NTQwNjc2Njk3MDAxODk5OTg5ODMzNTUyODQzMjg4OTg5MDE1NjI1NTQ4OTg0OTU1NjQ4ODA0ODY2NDE4ODM1MDI3ODkyNzEyMzIyNzEyOTA3OTM5Mjg5MDUxODIzMjg3OTYwOTM5MzI1ODk4MjcxMjE0MDc2MzIwMTM3NDg3NDE4MzUxMDIzNTg1ODk3Mjc5OTc3NDYzMjM1Mzk5Njc4Njc0ODEyMDQ1NTk5NDA1OTgzNDI2MzQxMDM2MDE5MTY5MjA1OTU3MzM4MDMyNjMxNTczMjM5NjY3ODEwNjgyMDU3MTQzNDUzMjc0OTMiXSwgWyJuYW1lIiwgIjUzMjA2MjI2MzY0MzUxMzM1NjcyMjMxODU5NDQxNjkzMTIxMDcwNTc4NjA1MDM0MjMzOTg1NTU2NjA2NDIxNjE2ODExMTc3NjA1NjcxODg5NDgwMzgyMDU0ODU0MDgzNzU5Mzc0ODgwNDQ2NjYxOTUyMTk4MjI2OTc4Njg0MTk1NTEwNjk0ODM1ODc5NTcxODc4NzExNDcyMjczMjI3NjEwNTYwMzgzODc1MTIzMTA1MjkyOTY1NTI0MjU1MTMwOTkzNTU5NDYyMjk0ODA3NDk5ODI2NzE2NzA1MDczNTY1NjY1OTYwMDgyMTUzMjQ1MjM2NjQ1ODU4Mzc1NjU3OTUzOTgxOTgwMDU1ODE3Mzg2MzU4MjQyODExNDQwMDc5OTM3Njk2NzUxMzgxNjg5NDM2NTI5MDA5MzM4MDMzMDM1NjA4MzY2ODI0NDA0MDA1NzY4ODk4OTM3ODI2OTI2MTMxNzAxNzk5NDc4ODY4MjEwNTg5NTMwNzEwODAzNTg4NTczODg3NTEwODYxMjE3OTM2NDcyMTQyMzY0NTk4OTk2MTk2Nzg3NTE3NzEwNTY1MTMwMDg2MDI5NzYxOTkyOTA4ODk4MDIzOTc4NTcyNjU2NjI2ODcwOTU4NTkzMzAxNjM3NTAxNDQ2ODk5OTcxMjYzNTIwMzQ5MDU4NzQ2Njg1MDM5MDAzMjUwOTA2NzY4NTQzMTU2ODU5ODA2NTQxMTQzNTA0MzAzOTA4NzQxNDMxMzAwMTU3MzQyMzc3ODczNTUxMTcyMjI2MjMyNDMyNDg1MzY4MTE0NjkzMTA2NDMyNjM5OTQ1NzIyODM1MjczNTkzMzg2MzA0MjI3NDE1NTMzNDM1NDI1NTg4NDQyNzYwMDc0NTkzNzQ2MzI4NjA4NTU4MjgwNzQyMzI5Njk1Mjg4OTciXSwgWyJkZWdyZWUiLCAiNDY3MDE1MzY5OTEyMzkwODA4MjkzMTM2Mjc4NDkxODU4MjA5MzQxNDk4OTg3NDQzNDk2NDk2MDI3NzU0NTc5MzgxODQ5NTUzMjE2MzA5OTcxMjY4Njk1ODkzNjY3MDI2MDY2NDI3OTY5NDE5Njk2MDEzMzgzNDc1MDc0ODY3MzY1Mzc4NTM3NDkxMDUwNjc1NjgwNzAzNjU1OTkyMDk0ODQ5MDUwNTMyNDExNTg4NjQ5NDI4Nzk4NzU3NzExNjA2OTkwMDk3Njc0MTI2ODQwMjMzMjM3MjU0ODYxNjMwMDM3OTE4Njk0Mzg4MjI5MTA0NDA5MDEyMjc4MDg3ODQyMDg0NjU2NzI4NTExMzU2ODg4MzQ2NTQ2NTg5NTUxMTM3Mzg0MTI2ODQ2ODYxNDUyOTU1MjU5NjU2MDIwODUxMzg4NDc3NDA0OTgyOTE0NzIxNjM2MTAzMTEzMjM3NTk3NjcwNDk1MDY2MzM0OTIzODUwMzM3NzgwNjY3OTU1NjY3MDkzMDExOTc0NDA2MzAwNTM0OTY4NDA4OTIxMTkwNzIzOTkwNTc1Njk5MjI0MjY4MzM2NjE1NTYwMjc0NjUzMzM4OTEwMzMyNDk1OTcyMDE0MTE5MDc2NzI3MzU2MDg5MDg2MjI3MjM2OTA4NjMxNjIwMzQwNzQ3ODY4NDY5Mzc4Njc0Nzk0ODc4MDczNDc2NTM5Mjk3NzEyMTAwNDI1ODQ5ODk2OTU5OTQxMzIxMzUxNzI4NjA4Mjc5OTI3MjIwNzM1MDYxMjYyMzYwNDQ5MDAyNjc1ODAyOTg4MTQyODM5ODcwNTg1MjI2NzgwNTc1ODgzMTA2OTMwNzY1NDQ2MzcxNzE0OTgwMzA1NDkwMzcxMTExMTkwMzgyOTY4Mjc1MzU5MTY4NTYwMjU0MDY2MDYzNiJdLCBbImFnZSIsICIxMTUwMDU4ODgxMzIxMzA5MjQ5NTk3MTkxMjAxMTY4NjEyNTAxNjQ3ODI5ODc1MTMwMTE2NDM5MjMxODk5NTUyOTM5OTgxMjE3NTUyMzk2ODE0NDQyMjMxMjY1Nzc0Nzk4OTc2NDY2OTkzMzQwMzkyNjczNzExOTM2OTY1NjExMzgyOTQzMTgxMjA2NTYyOTAzMzk3ODAyOTc1NTU4NzE1MDY1NTQ2OTQ3ODM4NTczMTQ1Mjg2NzgzODcxMDMyMTk1NDQ5MzU0NjU0MDUwOTQxMDI1MzU0NjEwNzU1MDc3MzIyNTI3NDI5NTEwNDkxMzc2OTQzODQ4MTMwNTg1NjkxMTc0OTc1MDM3NzE2MDgzNDc2NjQwMTczNDA2MzAzMjU1NjIxNTM5NDAwODYyMTQ4NDgxNjc4Mzk4MjUxMDg2MDY2NDEyNDkwMzY0NzEwNjMzOTMzNzAzODA1MTY5ODQyNTg4ODUzMDY4NzU1ODg1OTU4MzU1ODAwNjE5ODQ4MjQ5MzQ4ODM1NTkwMDEzNzY0ODQ3MDM1MDE2OTAyNTU1MjU5MTY2ODI5MDk0ODgwNTc0NzMzNjM2MjY2NzExODY2MjExMDYzODY5MDMwODk0NTE2OTYwNzY3NTMzMjA0NjE1NjQ3NzI4MzI3MDIzMjUwMTM2NjExODM4NzI5MDAxMTE3OTEyMjU1MDk5NDEwNzExNzY1NDA2NTYxNTg0NzI2MzM3MzgyMTc0NTE0Nzk5Nzg3NzAwNTEzNDMyNDQ5NTkxNjkzMjc2Mzk3Nzg0Mjk2MDQ5MTgxNTMxNjE1NTg0NjgzMTA5NjM0OTI2MzgwOTIzOTYxMDg5NjI4MzA1Mjc2NDE0NDIzNDQ0ODI3MTkxNTczMDQ0MDE4ODg1MzQ4NTYwOTU0Mjk1NDUzMzE5ODk0NTEyNyJdXX0sICJub25jZSI6ICI0NzI3NDUzNDM3NjAxNjkxMTEyMzU0ODkifQ=="
        }
      }
    ],
    "comment": "Offer on cred def id SazgVreUXtwF4ZBwAxUPwU:3:CL:25:default"
  }`

var offerDataDIDCommOrg = `  {
    "@type": "https://didcomm.org/issue-credential/1.0/offer-credential",
    "@id": "3dc323d4-17ec-4a4a-9d3a-uc903e94d253b",
    "~thread": {},
    "credential_preview": {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/issue-credential/1.0/credential-preview",
      "attributes": [
        { "name": "name", "value": "Alice Smith" },
        { "name": "date", "value": "2018-05-28" },
        { "name": "degree", "value": "Maths" },
        { "name": "age", "value": "24" }
      ]
    },
    "offers~attach": [
      {
        "@id": "libindy-cred-offer-0",
        "mime-type": "application/json",
        "data": {
          "base64": "eyJzY2hlbWFfaWQiOiAiU2F6Z1ZyZVVYdHdGNFpCd0F4VVB3VToyOmRlZ3JlZSBzY2hlbWE6MTUuNDMuOTMiLCAiY3JlZF9kZWZfaWQiOiAiU2F6Z1ZyZVVYdHdGNFpCd0F4VVB3VTozOkNMOjI1OmRlZmF1bHQiLCAia2V5X2NvcnJlY3RuZXNzX3Byb29mIjogeyJjIjogIjQwNTg1ODA1MTkyNjg1NTgwNDAxNzQwMDkxODI0MTM1MjkzMjY0NTQ0MTg0OTQ2MjA0MjY5OTc4Mjc4MTA5NDYxMzkyOTk1ODk2NyIsICJ4el9jYXAiOiAiOTAzNTE3NTE3ODI5NDMyNTI3ODIxOTY2Nzc4NDM5MTYzODY5NjMwNjgzNjk5MDgxMTkzMTg1OTAyNTk5MTAzNjM2ODQyMzMzNjI2MTk4NjA1MjM4NDc5OTgxNTUxNzY5MTYxNjMyNjY1MzgyNzMwMjAzNzI5Njg2NzAxNTc3MTc1MzEwNTg4NDkzMzM2MDgwNzAzNzE4ODAzNTA1OTcxNTQwNzY3ODYyMTY1NTgzMTI1NjcwNDAyNjI2NzUyMjgxNDE1MDczMTIyMzIzNDM4OTU4NjY2OTAyNjgwMzIwODczMDkzNTc1NDkyOTQxOTk4NjM3NjQ3OTQ0NzM5MTg3MzY4NzYxODc3ODQwMzYyMzg3NDk3MzkzMDcyMzAxNzA3MzQ4NzgxNjUxMjYzODE3NzY5MjE5OTk5MTg0NjM4MDA5MDE2NzMyMzU1Mzc0NjU4ODQ2NzAwNTI2NjgwNjMxMDk5ODcwMzM3NzUxNjc1MTI1MTU5Nzg1OTQ5NTAyNTYyNTAyMjY1Mjc3MTE4MzYyMzQ1OTkwNTIyMTQwMTcxNTg2Mzk5NjI4MjUxNzU2MTE3Mzg2Njc0NTgwNjcwMDQ4MjY5ODIzNzYxODI1Mjk1NjE3NTAyNzM4NTk5MjU5MzIzOTY2NDgxMTIzNjAxMzA3MjUxMjY1OTEyNjgwNTEwNjk0OTg1Mjc3MjQ0NTYyNTA3ODM5NTMwMjQ1NzkxMDIxOTIyNTg2NjExNzI4ODM2MzUwNzMwNTY2OTA5NDY4NjQ3NjM0NzcyMTIyOTI4NjUxNTY5ODI4MzA3NDExNjAzODc0NDE5Nzg0MDQ4OTc3NTMxOTQ3Njg0MDYwODY4NDYyNzE3MTQzMjAxNzc4NzM1MjUxNTk1Mzk2MjMyMDk0NzExNzY4NDY3MTA1MjU2OTU4NjQ2NCIsICJ4cl9jYXAiOiBbWyJtYXN0ZXJfc2VjcmV0IiwgIjg4Mzk4MjE4MjUzMDIwNzIwNTMxNDIxNTI5MTkzMDY4MjEzMjY3MTE5ODQ5OTkxMzA1MzIyODI5ODI5MDcxMzMxMjc4NTc2NTM2OTkzNjYxODE1Mjc3Mzk2OTI2NjUyNjY0NTE1MTY0NTU3Njk2NzI2MDc2NjY5NTc4MjAzMjMxNTk3NTEzNTkzODE4NjQ0MTM3NDY4MzI2MzAyMDI3NTUyMDc1MzgzNjk2Njg3NTgzMDk3NzM3MjMzNzkxODU4NjYzOTYwODY5NDMwODEwNDIwNzA5ODY3OTMyMzg2MjY3MzY5OTc2NjQ2OTE1NTk2ODMxMTgyNDYyNTM2MTk3MTU5OTUyMTcyMDUwMjA2NTA0MTk5Mjg3MTIxOTA0MTAwMDQ4OTQ1ODU0NDE0NjM1NDQxOTUzOTc1NjAyNDA3NDIyNDIwMzk5NzU3MzU0ODA2NjU0OTA5NzY1MDY4Mjg3MzkxMzc1MDYxNjEyMDk2MTE1NDUyOTEyMzUwNzMxNzczMDQxOTIyMjkxNDA5Mjk1NDY5OTUwODM1ODkxNDU3MDEwNDg2NzU0ODc0MzIwMjk0ODU5Njc5MzAxNDM1ODc5ODc1MDMyMDQ5OTE0MDcxNzUyNzUzNjk0MzM1OTcwMzYzNDc3ODk1NjAxNjA5NTg1ODA3NDc2NzM5MTQ0NTkxODU3ODExMDA1NjI0MDExMjkxNjMwMTQ0MTQ3MjU5MzU0MzIyNTA2NTc0OTk4ODQ1ODk4NDMzMzczNjgwNTA5MjI3MzM0NzU2MDMyMDUxMTUzOTU2NDg5NjYzMzczODUwNDE4NzU2MjQ4MTQzMTcxMjkzODI5Mzg4OTE2Nzg5ODQwMzY5OTExMDQ2MjE3NjY1NDYyNjkyMjg0MDQzODA5OTczMjcxMDAzMTg4NTkyNTA3MzQ3MjEiXSwgWyJkYXRlIiwgIjU0MzQyMTE0MDc3NzM3MTgxMzY4NzQ2NjU1MDU0MTMwOTAzMzcxNzc5MDE0OTg1MjU2NDUxNzg0MjgwNDA3ODE1MTgzNTQ5NjU4MjM3ODA1NjI1MjQyNzUxOTAxODk5NzA0MTkxMDA1NDczNTg0MzQyMzM4NzI5MTU4MDk5MTc3OTIyNDkwMDY0NDE3NTA5MzY2MTQwNDM0MDU5MzM1MzEwNjI3MDA5MTMyMDk4NjEwNzIyNTQ0ODIwMjQyMTQ2OTYzNjMzNzkzNTE0MzAxNDI4NzAzMTA1NjgwNDkyNDY1ODkyOTcwNTg1OTUzMjAyMzIwMjM5NzY1NzI4MjMyMjQxNzE0NzgxODM0ODI2OTMyNDcyNTM2NzAwODIwMzY1MzM1Mzc2ODI3MjE3MTUxMDI2NjE1NjE0MzUwMzYwMTg5NzY2MzIyNzk0MTI5NTcyNjE2NDc2MzAwMDAzMjU3ODUzMDE3NzIyNjQ1NzI1NTc4MzczODQyMjc5MjQ5MjU5NDc1MDE1NDI1NDQ5NjI5NTE0MjAzNzUwMDk5MDY1MDU4MjE5MTIwOTcwNDEwNTc1Nzc1NjM1OTMxOTgxNDAwMjkwNTcwNjc1NTQwNjc2Njk3MDAxODk5OTg5ODMzNTUyODQzMjg4OTg5MDE1NjI1NTQ4OTg0OTU1NjQ4ODA0ODY2NDE4ODM1MDI3ODkyNzEyMzIyNzEyOTA3OTM5Mjg5MDUxODIzMjg3OTYwOTM5MzI1ODk4MjcxMjE0MDc2MzIwMTM3NDg3NDE4MzUxMDIzNTg1ODk3Mjc5OTc3NDYzMjM1Mzk5Njc4Njc0ODEyMDQ1NTk5NDA1OTgzNDI2MzQxMDM2MDE5MTY5MjA1OTU3MzM4MDMyNjMxNTczMjM5NjY3ODEwNjgyMDU3MTQzNDUzMjc0OTMiXSwgWyJuYW1lIiwgIjUzMjA2MjI2MzY0MzUxMzM1NjcyMjMxODU5NDQxNjkzMTIxMDcwNTc4NjA1MDM0MjMzOTg1NTU2NjA2NDIxNjE2ODExMTc3NjA1NjcxODg5NDgwMzgyMDU0ODU0MDgzNzU5Mzc0ODgwNDQ2NjYxOTUyMTk4MjI2OTc4Njg0MTk1NTEwNjk0ODM1ODc5NTcxODc4NzExNDcyMjczMjI3NjEwNTYwMzgzODc1MTIzMTA1MjkyOTY1NTI0MjU1MTMwOTkzNTU5NDYyMjk0ODA3NDk5ODI2NzE2NzA1MDczNTY1NjY1OTYwMDgyMTUzMjQ1MjM2NjQ1ODU4Mzc1NjU3OTUzOTgxOTgwMDU1ODE3Mzg2MzU4MjQyODExNDQwMDc5OTM3Njk2NzUxMzgxNjg5NDM2NTI5MDA5MzM4MDMzMDM1NjA4MzY2ODI0NDA0MDA1NzY4ODk4OTM3ODI2OTI2MTMxNzAxNzk5NDc4ODY4MjEwNTg5NTMwNzEwODAzNTg4NTczODg3NTEwODYxMjE3OTM2NDcyMTQyMzY0NTk4OTk2MTk2Nzg3NTE3NzEwNTY1MTMwMDg2MDI5NzYxOTkyOTA4ODk4MDIzOTc4NTcyNjU2NjI2ODcwOTU4NTkzMzAxNjM3NTAxNDQ2ODk5OTcxMjYzNTIwMzQ5MDU4NzQ2Njg1MDM5MDAzMjUwOTA2NzY4NTQzMTU2ODU5ODA2NTQxMTQzNTA0MzAzOTA4NzQxNDMxMzAwMTU3MzQyMzc3ODczNTUxMTcyMjI2MjMyNDMyNDg1MzY4MTE0NjkzMTA2NDMyNjM5OTQ1NzIyODM1MjczNTkzMzg2MzA0MjI3NDE1NTMzNDM1NDI1NTg4NDQyNzYwMDc0NTkzNzQ2MzI4NjA4NTU4MjgwNzQyMzI5Njk1Mjg4OTciXSwgWyJkZWdyZWUiLCAiNDY3MDE1MzY5OTEyMzkwODA4MjkzMTM2Mjc4NDkxODU4MjA5MzQxNDk4OTg3NDQzNDk2NDk2MDI3NzU0NTc5MzgxODQ5NTUzMjE2MzA5OTcxMjY4Njk1ODkzNjY3MDI2MDY2NDI3OTY5NDE5Njk2MDEzMzgzNDc1MDc0ODY3MzY1Mzc4NTM3NDkxMDUwNjc1NjgwNzAzNjU1OTkyMDk0ODQ5MDUwNTMyNDExNTg4NjQ5NDI4Nzk4NzU3NzExNjA2OTkwMDk3Njc0MTI2ODQwMjMzMjM3MjU0ODYxNjMwMDM3OTE4Njk0Mzg4MjI5MTA0NDA5MDEyMjc4MDg3ODQyMDg0NjU2NzI4NTExMzU2ODg4MzQ2NTQ2NTg5NTUxMTM3Mzg0MTI2ODQ2ODYxNDUyOTU1MjU5NjU2MDIwODUxMzg4NDc3NDA0OTgyOTE0NzIxNjM2MTAzMTEzMjM3NTk3NjcwNDk1MDY2MzM0OTIzODUwMzM3NzgwNjY3OTU1NjY3MDkzMDExOTc0NDA2MzAwNTM0OTY4NDA4OTIxMTkwNzIzOTkwNTc1Njk5MjI0MjY4MzM2NjE1NTYwMjc0NjUzMzM4OTEwMzMyNDk1OTcyMDE0MTE5MDc2NzI3MzU2MDg5MDg2MjI3MjM2OTA4NjMxNjIwMzQwNzQ3ODY4NDY5Mzc4Njc0Nzk0ODc4MDczNDc2NTM5Mjk3NzEyMTAwNDI1ODQ5ODk2OTU5OTQxMzIxMzUxNzI4NjA4Mjc5OTI3MjIwNzM1MDYxMjYyMzYwNDQ5MDAyNjc1ODAyOTg4MTQyODM5ODcwNTg1MjI2NzgwNTc1ODgzMTA2OTMwNzY1NDQ2MzcxNzE0OTgwMzA1NDkwMzcxMTExMTkwMzgyOTY4Mjc1MzU5MTY4NTYwMjU0MDY2MDYzNiJdLCBbImFnZSIsICIxMTUwMDU4ODgxMzIxMzA5MjQ5NTk3MTkxMjAxMTY4NjEyNTAxNjQ3ODI5ODc1MTMwMTE2NDM5MjMxODk5NTUyOTM5OTgxMjE3NTUyMzk2ODE0NDQyMjMxMjY1Nzc0Nzk4OTc2NDY2OTkzMzQwMzkyNjczNzExOTM2OTY1NjExMzgyOTQzMTgxMjA2NTYyOTAzMzk3ODAyOTc1NTU4NzE1MDY1NTQ2OTQ3ODM4NTczMTQ1Mjg2NzgzODcxMDMyMTk1NDQ5MzU0NjU0MDUwOTQxMDI1MzU0NjEwNzU1MDc3MzIyNTI3NDI5NTEwNDkxMzc2OTQzODQ4MTMwNTg1NjkxMTc0OTc1MDM3NzE2MDgzNDc2NjQwMTczNDA2MzAzMjU1NjIxNTM5NDAwODYyMTQ4NDgxNjc4Mzk4MjUxMDg2MDY2NDEyNDkwMzY0NzEwNjMzOTMzNzAzODA1MTY5ODQyNTg4ODUzMDY4NzU1ODg1OTU4MzU1ODAwNjE5ODQ4MjQ5MzQ4ODM1NTkwMDEzNzY0ODQ3MDM1MDE2OTAyNTU1MjU5MTY2ODI5MDk0ODgwNTc0NzMzNjM2MjY2NzExODY2MjExMDYzODY5MDMwODk0NTE2OTYwNzY3NTMzMjA0NjE1NjQ3NzI4MzI3MDIzMjUwMTM2NjExODM4NzI5MDAxMTE3OTEyMjU1MDk5NDEwNzExNzY1NDA2NTYxNTg0NzI2MzM3MzgyMTc0NTE0Nzk5Nzg3NzAwNTEzNDMyNDQ5NTkxNjkzMjc2Mzk3Nzg0Mjk2MDQ5MTgxNTMxNjE1NTg0NjgzMTA5NjM0OTI2MzgwOTIzOTYxMDg5NjI4MzA1Mjc2NDE0NDIzNDQ0ODI3MTkxNTczMDQ0MDE4ODg1MzQ4NTYwOTU0Mjk1NDUzMzE5ODk0NTEyNyJdXX0sICJub25jZSI6ICI0NzI3NDUzNDM3NjAxNjkxMTEyMzU0ODkifQ=="
        }
      }
    ],
    "comment": "Offer on cred def id SazgVreUXtwF4ZBwAxUPwU:3:CL:25:default"
  }`

var requestDataDIDOrg = `{
    "@type": "https://didcomm.org/issue-credential/1.0/request-credential",
    "@id": "dfd5dcaa-67f4-4c84-aed7-767cf7291f1e",
    "~thread": { "thid": "3dc323d4-17ec-4a4a-9d3a-c903e94d253b" },
    "requests~attach": [
      {
        "@id": "libindy-cred-request-0",
        "mime-type": "application/json",
        "data": {
          "base64": "eyJwcm92ZXJfZGlkIjogIkVSWWloem5kaWVUZGg0VUE3UTZZM0MiLCAiY3JlZF9kZWZfaWQiOiAiU2F6Z1ZyZVVYdHdGNFpCd0F4VVB3VTozOkNMOjI1OmRlZmF1bHQiLCAiYmxpbmRlZF9tcyI6IHsidSI6ICIxMDY4NzE2OTI4MDYwODY0MjY1NzAyMjI5MTY1MDUzNjM3OTMwMTczODQ5MjcxMDE5MTMxOTI5NTI0MTg1NDAyMTEzNDYzNTMxMjQ3NjEwNTkzNTkxOTY3OTI2Mzc5OTMxNTY3ODQ4NDc0NDQ5MDAwMzAwOTY3NDczNTQyMzc1MzkxOTk3NDkwNTQxOTI2MTIyMzgxMTk3NzA3MjEyMjI5NTc2NjczMDMwMzM5MTE1MjkxNTAyNjIyNDc2NzQzOTcyOTQwNzkxMjg0NzU0MTc0NDE2Mjc4NDM5MjAwOTU1NDA1ODk0NjQzMTI1Nzk5Njc2MTMxMzE4NzM2NzE5MTc5NDQ4MDA3NDk2NTI4MDI5MjUzMjA0MjA3NDUzODE4NzExOTAzODkzNzg1OTYxMTA3NTcwNDQ0OTA2NjYyMDcxMzgwODA5NTM5Njc1NDU1ODQ1Mjc4MzM0NTg0MDAyOTc4NTc3Nzg2MDgwODM1NjA2MzIxMTI4MDc2NjA5NjI4NDk0NjYyMjE4ODM5MzEzNzQxMTM1MDM3NTI5MTgwODg0ODIwMzQzMzMyMjY1NzA0NDg1Mjg2MDc1ODU2NzQzMzM0NzE2NDYxNTc5ODMxNDEwMTQ0NDEzMzY5MDYxNzczNDIwOTE2MDYzNzg2MzU4MTU2ODg1NzUwMDQzNTYyMTQyNzY3ODIxMDM5Mzk1MzAzNjgwMDMwMjI3OTQ5MTE3NDUyOTgzNTIwODczNDE4MDc1ODE5NTY2NzEyMTY4ODM0NTc1MDA2Mjc3ODMyNDQ0ODE4NjMzMDA1MDAyNDgwMTY0NjU4NTkzNTgxOCIsICJ1ciI6IG51bGwsICJoaWRkZW5fYXR0cmlidXRlcyI6IFsibWFzdGVyX3NlY3JldCJdLCAiY29tbWl0dGVkX2F0dHJpYnV0ZXMiOiB7fX0sICJibGluZGVkX21zX2NvcnJlY3RuZXNzX3Byb29mIjogeyJjIjogIjE0NDUzOTkyNzU3MjE5OTkyNDMwODU2NDUzOTY2ODgzMTc0NTU4ODMyNzg4MTc4MzMxMjE2MzQyMTIyNzE0MjEwODk1MjE0MTM2NDk5IiwgInZfZGFzaF9jYXAiOiAiNjg4NTI0MTQ1MjY3NjAxNTA0MDE1NzY3ODUwMjA2Mjg5NTkxMTEyNjMyODg1NDE2MzAzODE1ODYxNDU1MTMwMjU4Mzk2ODIxOTk5NDc3MDA3MTc1MTUzMjAwNDc4NDIwODc0NTc3OTkyNzcxMTQ2NjgzMzcxMzYyNTM1MTY0Mjk2ODU0NjQyNzk0MjM5NDgxNzUzMzM3NTYwNTUzMjQzMzE4NTkyNDU5NTI0Mzg0OTUwOTg0Mzc1NDUwMTM1MzUzOTcwNjQ1NDQzNjkzMTY4OTM3MzgwNjg3MzAwMTI1NjMwODMyODcxMzg5MjM0NDgzODgxMzk2MzAzNDAxOTA5Nzg4NzEwMzM4MDM1Mzk4Mzg5MDk2NDA4MTk3MjE2NTQ4NzkzNTk0MzcxNjkzNzYyNjE5MjgzNTExMjEzODMxMDgyODUyMzg5MTQ1OTQ2MzQyMDY5MjgxNjQwNzE2MzkyNzEyOTU2ODY0OTg4NzEwNjM3NTg4NTE3ODgyNDAyMDg5NDI5MzgwOTYyOTEwNTY1NjI1NjgxMTczNDk1NzMzNTM4MjEwNjQyNzE2NDI5OTI3MTEzMjQyNDQyMDkwMDM0NDA5MjAwMTQ1MTIxODU1NTIwODEyOTQ5MTkzODIxMTUwMzExNzE3OTQ5NjQwMTEwNjgzNDcwMTQyMzE4NzM5NTk5NzIxNzkwMzkyNjM0NjgwMDk5NDM2NjAxMTM4ODUzMDc5NzQwMzQ4NDM0NDMyMjM4MTE1MzA1NTUyNTA5MTQ1OTYwMTcyODQ5MTIyOTA0OTEwOTc5OTMzNTQ4MTQzMDQzNjQzOTQzNDMwNjIyODgxMTE2ODYyNDY5NTEzMDIyMjg2OTkyMzk2MTk3NzI0NzQxMjA1MjMwMjcxMTY4MTc0OTUwNjM1NjcyNTM1NTI3MDE4NzYwODYyMjY5NTU5MjUyODEzOTM5NDQ5MjkiLCAibV9jYXBzIjogeyJtYXN0ZXJfc2VjcmV0IjogIjE2NDA4NjY4MTg5NTM4MTU0NjY1NDAyNTMzNzc1ODg5NjQwNjk4NDU2NTUzOTM5ODU0MTUyMTU4NzAwNjU2MDAxNzkyNDkyODE2NDMxODMyNjYxMjkwMTIwMzQ3NTgzNDI5ODk4MzQyNTM3MzE4OTY4OTAyNjAzNjA2MTU2NTM4NTg1MTYxNTU0NjIxNjQwMDU4MzAxMjQ1NzE5MjQ5ODcyNzc1NzQwNjAyMTQ2ODI0NzgzIn0sICJyX2NhcHMiOiB7fX0sICJub25jZSI6ICI2NTM2MTc5ODM1MTY0MzQzMTEzMzc4OTQifQ=="
        }
      }
    ]
  }`

var requestData = `{
    "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/issue-credential/1.0/request-credential",
    "@id": "dfd5dcaa-67f4-4c84-aed7-767cf7291f1e",
    "~thread": { "thid": "3dc323d4-17ec-4a4a-9d3a-c903e94d253b" },
    "requests~attach": [
      {
        "@id": "libindy-cred-request-0",
        "mime-type": "application/json",
        "data": {
          "base64": "eyJwcm92ZXJfZGlkIjogIkVSWWloem5kaWVUZGg0VUE3UTZZM0MiLCAiY3JlZF9kZWZfaWQiOiAiU2F6Z1ZyZVVYdHdGNFpCd0F4VVB3VTozOkNMOjI1OmRlZmF1bHQiLCAiYmxpbmRlZF9tcyI6IHsidSI6ICIxMDY4NzE2OTI4MDYwODY0MjY1NzAyMjI5MTY1MDUzNjM3OTMwMTczODQ5MjcxMDE5MTMxOTI5NTI0MTg1NDAyMTEzNDYzNTMxMjQ3NjEwNTkzNTkxOTY3OTI2Mzc5OTMxNTY3ODQ4NDc0NDQ5MDAwMzAwOTY3NDczNTQyMzc1MzkxOTk3NDkwNTQxOTI2MTIyMzgxMTk3NzA3MjEyMjI5NTc2NjczMDMwMzM5MTE1MjkxNTAyNjIyNDc2NzQzOTcyOTQwNzkxMjg0NzU0MTc0NDE2Mjc4NDM5MjAwOTU1NDA1ODk0NjQzMTI1Nzk5Njc2MTMxMzE4NzM2NzE5MTc5NDQ4MDA3NDk2NTI4MDI5MjUzMjA0MjA3NDUzODE4NzExOTAzODkzNzg1OTYxMTA3NTcwNDQ0OTA2NjYyMDcxMzgwODA5NTM5Njc1NDU1ODQ1Mjc4MzM0NTg0MDAyOTc4NTc3Nzg2MDgwODM1NjA2MzIxMTI4MDc2NjA5NjI4NDk0NjYyMjE4ODM5MzEzNzQxMTM1MDM3NTI5MTgwODg0ODIwMzQzMzMyMjY1NzA0NDg1Mjg2MDc1ODU2NzQzMzM0NzE2NDYxNTc5ODMxNDEwMTQ0NDEzMzY5MDYxNzczNDIwOTE2MDYzNzg2MzU4MTU2ODg1NzUwMDQzNTYyMTQyNzY3ODIxMDM5Mzk1MzAzNjgwMDMwMjI3OTQ5MTE3NDUyOTgzNTIwODczNDE4MDc1ODE5NTY2NzEyMTY4ODM0NTc1MDA2Mjc3ODMyNDQ0ODE4NjMzMDA1MDAyNDgwMTY0NjU4NTkzNTgxOCIsICJ1ciI6IG51bGwsICJoaWRkZW5fYXR0cmlidXRlcyI6IFsibWFzdGVyX3NlY3JldCJdLCAiY29tbWl0dGVkX2F0dHJpYnV0ZXMiOiB7fX0sICJibGluZGVkX21zX2NvcnJlY3RuZXNzX3Byb29mIjogeyJjIjogIjE0NDUzOTkyNzU3MjE5OTkyNDMwODU2NDUzOTY2ODgzMTc0NTU4ODMyNzg4MTc4MzMxMjE2MzQyMTIyNzE0MjEwODk1MjE0MTM2NDk5IiwgInZfZGFzaF9jYXAiOiAiNjg4NTI0MTQ1MjY3NjAxNTA0MDE1NzY3ODUwMjA2Mjg5NTkxMTEyNjMyODg1NDE2MzAzODE1ODYxNDU1MTMwMjU4Mzk2ODIxOTk5NDc3MDA3MTc1MTUzMjAwNDc4NDIwODc0NTc3OTkyNzcxMTQ2NjgzMzcxMzYyNTM1MTY0Mjk2ODU0NjQyNzk0MjM5NDgxNzUzMzM3NTYwNTUzMjQzMzE4NTkyNDU5NTI0Mzg0OTUwOTg0Mzc1NDUwMTM1MzUzOTcwNjQ1NDQzNjkzMTY4OTM3MzgwNjg3MzAwMTI1NjMwODMyODcxMzg5MjM0NDgzODgxMzk2MzAzNDAxOTA5Nzg4NzEwMzM4MDM1Mzk4Mzg5MDk2NDA4MTk3MjE2NTQ4NzkzNTk0MzcxNjkzNzYyNjE5MjgzNTExMjEzODMxMDgyODUyMzg5MTQ1OTQ2MzQyMDY5MjgxNjQwNzE2MzkyNzEyOTU2ODY0OTg4NzEwNjM3NTg4NTE3ODgyNDAyMDg5NDI5MzgwOTYyOTEwNTY1NjI1NjgxMTczNDk1NzMzNTM4MjEwNjQyNzE2NDI5OTI3MTEzMjQyNDQyMDkwMDM0NDA5MjAwMTQ1MTIxODU1NTIwODEyOTQ5MTkzODIxMTUwMzExNzE3OTQ5NjQwMTEwNjgzNDcwMTQyMzE4NzM5NTk5NzIxNzkwMzkyNjM0NjgwMDk5NDM2NjAxMTM4ODUzMDc5NzQwMzQ4NDM0NDMyMjM4MTE1MzA1NTUyNTA5MTQ1OTYwMTcyODQ5MTIyOTA0OTEwOTc5OTMzNTQ4MTQzMDQzNjQzOTQzNDMwNjIyODgxMTE2ODYyNDY5NTEzMDIyMjg2OTkyMzk2MTk3NzI0NzQxMjA1MjMwMjcxMTY4MTc0OTUwNjM1NjcyNTM1NTI3MDE4NzYwODYyMjY5NTU5MjUyODEzOTM5NDQ5MjkiLCAibV9jYXBzIjogeyJtYXN0ZXJfc2VjcmV0IjogIjE2NDA4NjY4MTg5NTM4MTU0NjY1NDAyNTMzNzc1ODg5NjQwNjk4NDU2NTUzOTM5ODU0MTUyMTU4NzAwNjU2MDAxNzkyNDkyODE2NDMxODMyNjYxMjkwMTIwMzQ3NTgzNDI5ODk4MzQyNTM3MzE4OTY4OTAyNjAzNjA2MTU2NTM4NTg1MTYxNTU0NjIxNjQwMDU4MzAxMjQ1NzE5MjQ5ODcyNzc1NzQwNjAyMTQ2ODI0NzgzIn0sICJyX2NhcHMiOiB7fX0sICJub25jZSI6ICI2NTM2MTc5ODM1MTY0MzQzMTEzMzc4OTQifQ=="
        }
      }
    ]
  }`

var issueData = `{
    "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/issue-credential/1.0/issue-credential",
    "@id": "ac8120e9-ee55-4f64-a385-5e429916a1e1",
    "~thread": { "thid": "3dc323d4-17ec-4a4a-9d3a-c903e94d253b" },
    "credentials~attach": [
      {
        "@id": "libindy-cred-0",
        "mime-type": "application/json",
        "data": {
          "base64": "eyJzY2hlbWFfaWQiOiAiU2F6Z1ZyZVVYdHdGNFpCd0F4VVB3VToyOmRlZ3JlZSBzY2hlbWE6MTUuNDMuOTMiLCAiY3JlZF9kZWZfaWQiOiAiU2F6Z1ZyZVVYdHdGNFpCd0F4VVB3VTozOkNMOjI1OmRlZmF1bHQiLCAicmV2X3JlZ19pZCI6IG51bGwsICJ2YWx1ZXMiOiB7ImFnZSI6IHsicmF3IjogIjI0IiwgImVuY29kZWQiOiAiMjQifSwgImRlZ3JlZSI6IHsicmF3IjogIk1hdGhzIiwgImVuY29kZWQiOiAiNDYwMjczMjI5MjIwNDA4NTQyMTc4NzI5MzI4OTQ4NTQ4MjM1MTMyOTA1MzkzNDAwMDAxNTgyMzQyOTQ0MTQ3ODEzOTg0NjYwNzcyIn0sICJkYXRlIjogeyJyYXciOiAiMjAxOC0wNS0yOCIsICJlbmNvZGVkIjogIjIzNDAyNjM3NDIzODc2MzI0MDk4MjU2NTE5MzE3Njk1NDMzMTk2ODEzMjE3Nzg1Nzk1MzE3MjIwNjgwNDE1ODEyMzQ4ODAxMDg2NTg2In0sICJuYW1lIjogeyJyYXciOiAiQWxpY2UgU21pdGgiLCAiZW5jb2RlZCI6ICI2MjgxNjgxMDIyNjkzNjY1NDc5Nzc3OTcwNTAwMDc3Mjk2ODA1ODI4Mzc4MDEyNDMwOTA3NzA0OTY4MTczNDgzNTc5NjMzMjcwNDQxMyJ9fSwgInNpZ25hdHVyZSI6IHsicF9jcmVkZW50aWFsIjogeyJtXzIiOiAiNzAwNzQ1OTE5MjMzMjY2MDM0OTI3MzY0NzUyNDQ2MDc1MDE0NTgwMTAzMTczMTcxNDUyNjM0ODUzNzE1Nzc5NjY5MjIzODQ5OTY2OTMiLCAiYSI6ICI1Mzc1NzE4NDc0ODc3OTk5NTMwMzc0MjgzNDc4OTAzMzkzODgwMTY5NjkwMDg5MzgyNzM1NDc1MjQzNDc4MTI0NjQ1NjU2Mjg4OTIzNzEzODQ5MzgxMTExMjIxMTcxNTIyNzY1ODgyNDc1MjU5ODQxMDYzNjEzOTc4NjQyMzUzMDMxMTY3MjQwMDkyMzA3MjA1MjIxNjM0MTg3MTQwMzMxNDA2MjQ1NDUzNjkxNjY0MTAxNzI0NTg4MzkzNjQyNzU3OTI3MjM5NjA2ODgxNDcwNjIyMDM5MjY4MzgyOTE5MjE0ODI4NjkzNzM3OTYyOTU0MTk4ODc0OTUxMjUxMjQ0ODQwODk3NzIwNDA5NzYwNTQ0NzAxMTc4NDY3NDc0NjA2ODU0OTA5ODg1Nzk1OTA0OTMzMjg5MDUxMjcyMzA1MjUyOTk2NDc4Njk4OTEyMDM4MjE3OTk1NjM1NDQ3MDYwMTMzNTQyNjk4MDY5NjcyNjI2OTA1NDIwMTg1NjQzMzM3NzY4NzIyMDMyOTI5MDc4MTU4MTU1NDI0NjIxNzUxNzg5NDQ3ODIzOTgxOTg3MzMyMDUxNDc2ODkzODIyMjkxNDE3NTE1MjUyMDIwNTY4Mzg3ODQ5NTY0NDc5MjkyMjY1NTk5NjcxODU3MDI1ODEzNjM1NTQ1Mzk4Nzg5MjA4NTg5NTU4OTAyNTI1MzQ1MjQ2MzEwMjIyMTg1ODIxODc4MTY4MDQzMDA3MDE0OTE5MzMxMDI1MTc4MjYyOTUzNjc3MDM5Nzk4ODg4MDk4NjM5MjQyMjk4MDM5ODEzNjEwMDQwNDQ4MTEiLCAiZSI6ICIyNTkzNDQ3MjMwNTUwNjIwNTk5MDcwMjU0OTE0ODA2OTc1NzE5MzgyNzc4ODk1MTUxNTIzMDYyNDk3Mjg1ODMxMDU2NjU4MDA3MTMzMDY3NTkxNDk5ODE2OTA1NTkxOTM5ODcxNDMwMTIzNjc5MTMyMDYyOTkzMjM4OTk2OTY5NDIyMTMyMzU5NTY3NDI5MzAyODYxMTEzMDkwOTE5NTQyNjYwMDkzMjEzMDMwNDg0MDc1MTciLCAidiI6ICI1ODAzNzAwNzA5OTMxOTkxNDEwNDg0NzUyMzU5NzIzMDk3NDAzMTE4NjI3MDg0NzUwNzkwNTY2NjQxNTAwNzE4ODU1MzUxOTIwNTg5NzUzMDA1NTg5MTc1MDA2NTI4Mzc2ODk3Njg4Nzk2Nzc1NTUwNzU1MDMwNjM4MTU0NDY4NzgxNTYwMTUyODU1NzQ4NDE5Mjc3Mzk1NjkxNTE2MzAxNjU5NzMzOTI5Mjc3MDMzODQwMDUyMTMwNDMyOTg3MzEwNTYyMTk1NjQyMzA5MzUyMTcxMzkyNjEyNjczOTYxNTkyODg2MTU0MDk4MzQ4MTU0ODg1MDYxNTIyNTQyODUzNTMwNzkxMDQ3MDc3MDY1NzA0MjEzMjYxNTg0NDM3MDQxNzAxMTU3OTE5NTkxNTg3MzkxNzMwNzQwNzcyMTM1MzQ1MjAyNzkyOTAzMzAyOTk5ODA0MTQ3NzE4Njc1NDY3MDcyMTYyMTY1ODg3Nzg1NjkwNTc0MzAzOTM1NjgwNTgxMjg0NTM3OTgwNTEwMDA2NzQzMTU2NjYzNjAxMzg5MTY1MDUwMjk2NTM5MTM5MDI2OTY5ODE5NjYzNDQ4MDc5ODY5MjAyMTc3ODA1NzYwMTc3NjI3NzgyNTIwNTI2ODkyMzI2NzkxNDU0MTQxODQ4Nzc1Njk4ODUyMjcyMDU1ODAxOTUzODUzOTgyNDk1ODkzNDgzMTU5MDg1NzYxNjU4NTY0ODk5NTY3MjgxMDAwNDkwOTM3ODIzMTI2MDY4ODE0NDY3MzY3OTIzMTczMzIzNDAyNTcxMTY0MTYwMzEzOTA0NzUxNDM4MDMyMzI2MzY0NDk3NzYxMTczNzY1NTczNDEwMTkyODk1OTI4ODQyOTUyNDAwMTkxNjI4ODExNDYzNzg0NDMxNzE1NzA2MzkwNDcxMzgxMDc0NjgzNzkyMjU3MTMyOTYxNjI0NDEyNDE3MDU2ODE2NDU1OTUzMjMxODExNTA3NTc3Mzc3OTc0MDIzMjE0NDA4NDQ1NTQzMzg2NDg2Mjg2NDQ1NTMyMjM3MzEwNzQ0NjUyNDU1MDYzMzI3NTAzNTUzMTIzOTk3Mjc2NTU4In0sICJyX2NyZWRlbnRpYWwiOiBudWxsfSwgInNpZ25hdHVyZV9jb3JyZWN0bmVzc19wcm9vZiI6IHsic2UiOiAiMjQxODk4MTI0NDYzOTI4NjM1MDQ5NzI3NTk5Mzg5Mjg3MDg1MDI4NTg3NTkyNTg0OTc0NjcxNDIwMTg3Nzg1MDI2MDg4ODU0NzExODE1MjU5MzE3MDMzMTYyOTI3MjIxMjQ3NzMyOTgyNDE0MzE1NTE1ODI5MTA1MzI3MDUxNjg3Mzc0NDU4MTk3NjIwODI5NDY3OTAzMDUxMDIyOTAyNDk4OTU4MzM2Nzc3ODY3Mzc1ODk2Mzg2Njg4NjIyNzU3NzQwODg5NzQxMzg4ODcyOTAzMjQzNzEyMDg4MjE4MjkwMzQ5NzkwNzUzNDg1MjYyOTg4MDUxNzYyNTk2Nzk0MDk3OTU4MTYyNTQwMzM0NjMxMzgzNzM2NDU4MjEyNDYzMDc1MzYyMzI5NTg0NzY1NTE5NDcyNzg0NDE3MTQwNzQyMTg5MzYzNzcwMjk0NjcwMzA1NzAyNTI4NDA5MzUxMzI4NDI4ODY5NTg1MTM0OTI4OTE2Njg0MjQxMDgxODIyNzYzMDY2MjA3NzgxOTM1NDEyODExMjI2OTYxOTE4NTA5OTMyOTAzODIwMzU1NzA3MjE2NTA0NTc2Mzc5MjQ0ODk0Mzk4MzUwMzE5MTczNjcyMTcxMzUwNDI4ODM2NTAyNjMzNzY4ODE0MzkzNzU4MTUzMDgyMjQ4NjE1Nzc5MTk3Mjg3OTc2MTY4OTMzMzM1ODU2NzI1NzQ2MzM1NzczMzg0MDcwMDY5MzIxMjY2NzAwNTg5OTI2NjUwODk1OTk1NTg3ODg1NjM1OTAxMzQxMTA2NTczMjMzMDIxNzExNTUyMTM5MTc0NjgiLCAiYyI6ICI2MjA1MzIyODY5Mzg2NjQwMTkzNzUyNjE1NTUwMTM2NDU0NzMxNzA4NjkyNjkxMTYzMDg0OTI3NTc1NzY2MTMzMjc0MTUyOTYyOTAwMiJ9LCAicmV2X3JlZyI6IG51bGwsICJ3aXRuZXNzIjogbnVsbH0="
        }
      }
    ],
    "comment": "Issuing credential, exchange 989f77ef-5d87-4252-bb70-aa417dfcf7f2"
  }`

var issueDataDIDOrg = `{
    "@type": "https://didcomm.org/issue-credential/1.0/issue-credential",
    "@id": "ac8120e9-ee55-4f64-a385-5e429916a1e1",
    "~thread": { "thid": "3dc323d4-17ec-4a4a-9d3a-c903e94d253b" },
    "credentials~attach": [
      {
        "@id": "libindy-cred-0",
        "mime-type": "application/json",
        "data": {
          "base64": "eyJzY2hlbWFfaWQiOiAiU2F6Z1ZyZVVYdHdGNFpCd0F4VVB3VToyOmRlZ3JlZSBzY2hlbWE6MTUuNDMuOTMiLCAiY3JlZF9kZWZfaWQiOiAiU2F6Z1ZyZVVYdHdGNFpCd0F4VVB3VTozOkNMOjI1OmRlZmF1bHQiLCAicmV2X3JlZ19pZCI6IG51bGwsICJ2YWx1ZXMiOiB7ImFnZSI6IHsicmF3IjogIjI0IiwgImVuY29kZWQiOiAiMjQifSwgImRlZ3JlZSI6IHsicmF3IjogIk1hdGhzIiwgImVuY29kZWQiOiAiNDYwMjczMjI5MjIwNDA4NTQyMTc4NzI5MzI4OTQ4NTQ4MjM1MTMyOTA1MzkzNDAwMDAxNTgyMzQyOTQ0MTQ3ODEzOTg0NjYwNzcyIn0sICJkYXRlIjogeyJyYXciOiAiMjAxOC0wNS0yOCIsICJlbmNvZGVkIjogIjIzNDAyNjM3NDIzODc2MzI0MDk4MjU2NTE5MzE3Njk1NDMzMTk2ODEzMjE3Nzg1Nzk1MzE3MjIwNjgwNDE1ODEyMzQ4ODAxMDg2NTg2In0sICJuYW1lIjogeyJyYXciOiAiQWxpY2UgU21pdGgiLCAiZW5jb2RlZCI6ICI2MjgxNjgxMDIyNjkzNjY1NDc5Nzc3OTcwNTAwMDc3Mjk2ODA1ODI4Mzc4MDEyNDMwOTA3NzA0OTY4MTczNDgzNTc5NjMzMjcwNDQxMyJ9fSwgInNpZ25hdHVyZSI6IHsicF9jcmVkZW50aWFsIjogeyJtXzIiOiAiNzAwNzQ1OTE5MjMzMjY2MDM0OTI3MzY0NzUyNDQ2MDc1MDE0NTgwMTAzMTczMTcxNDUyNjM0ODUzNzE1Nzc5NjY5MjIzODQ5OTY2OTMiLCAiYSI6ICI1Mzc1NzE4NDc0ODc3OTk5NTMwMzc0MjgzNDc4OTAzMzkzODgwMTY5NjkwMDg5MzgyNzM1NDc1MjQzNDc4MTI0NjQ1NjU2Mjg4OTIzNzEzODQ5MzgxMTExMjIxMTcxNTIyNzY1ODgyNDc1MjU5ODQxMDYzNjEzOTc4NjQyMzUzMDMxMTY3MjQwMDkyMzA3MjA1MjIxNjM0MTg3MTQwMzMxNDA2MjQ1NDUzNjkxNjY0MTAxNzI0NTg4MzkzNjQyNzU3OTI3MjM5NjA2ODgxNDcwNjIyMDM5MjY4MzgyOTE5MjE0ODI4NjkzNzM3OTYyOTU0MTk4ODc0OTUxMjUxMjQ0ODQwODk3NzIwNDA5NzYwNTQ0NzAxMTc4NDY3NDc0NjA2ODU0OTA5ODg1Nzk1OTA0OTMzMjg5MDUxMjcyMzA1MjUyOTk2NDc4Njk4OTEyMDM4MjE3OTk1NjM1NDQ3MDYwMTMzNTQyNjk4MDY5NjcyNjI2OTA1NDIwMTg1NjQzMzM3NzY4NzIyMDMyOTI5MDc4MTU4MTU1NDI0NjIxNzUxNzg5NDQ3ODIzOTgxOTg3MzMyMDUxNDc2ODkzODIyMjkxNDE3NTE1MjUyMDIwNTY4Mzg3ODQ5NTY0NDc5MjkyMjY1NTk5NjcxODU3MDI1ODEzNjM1NTQ1Mzk4Nzg5MjA4NTg5NTU4OTAyNTI1MzQ1MjQ2MzEwMjIyMTg1ODIxODc4MTY4MDQzMDA3MDE0OTE5MzMxMDI1MTc4MjYyOTUzNjc3MDM5Nzk4ODg4MDk4NjM5MjQyMjk4MDM5ODEzNjEwMDQwNDQ4MTEiLCAiZSI6ICIyNTkzNDQ3MjMwNTUwNjIwNTk5MDcwMjU0OTE0ODA2OTc1NzE5MzgyNzc4ODk1MTUxNTIzMDYyNDk3Mjg1ODMxMDU2NjU4MDA3MTMzMDY3NTkxNDk5ODE2OTA1NTkxOTM5ODcxNDMwMTIzNjc5MTMyMDYyOTkzMjM4OTk2OTY5NDIyMTMyMzU5NTY3NDI5MzAyODYxMTEzMDkwOTE5NTQyNjYwMDkzMjEzMDMwNDg0MDc1MTciLCAidiI6ICI1ODAzNzAwNzA5OTMxOTkxNDEwNDg0NzUyMzU5NzIzMDk3NDAzMTE4NjI3MDg0NzUwNzkwNTY2NjQxNTAwNzE4ODU1MzUxOTIwNTg5NzUzMDA1NTg5MTc1MDA2NTI4Mzc2ODk3Njg4Nzk2Nzc1NTUwNzU1MDMwNjM4MTU0NDY4NzgxNTYwMTUyODU1NzQ4NDE5Mjc3Mzk1NjkxNTE2MzAxNjU5NzMzOTI5Mjc3MDMzODQwMDUyMTMwNDMyOTg3MzEwNTYyMTk1NjQyMzA5MzUyMTcxMzkyNjEyNjczOTYxNTkyODg2MTU0MDk4MzQ4MTU0ODg1MDYxNTIyNTQyODUzNTMwNzkxMDQ3MDc3MDY1NzA0MjEzMjYxNTg0NDM3MDQxNzAxMTU3OTE5NTkxNTg3MzkxNzMwNzQwNzcyMTM1MzQ1MjAyNzkyOTAzMzAyOTk5ODA0MTQ3NzE4Njc1NDY3MDcyMTYyMTY1ODg3Nzg1NjkwNTc0MzAzOTM1NjgwNTgxMjg0NTM3OTgwNTEwMDA2NzQzMTU2NjYzNjAxMzg5MTY1MDUwMjk2NTM5MTM5MDI2OTY5ODE5NjYzNDQ4MDc5ODY5MjAyMTc3ODA1NzYwMTc3NjI3NzgyNTIwNTI2ODkyMzI2NzkxNDU0MTQxODQ4Nzc1Njk4ODUyMjcyMDU1ODAxOTUzODUzOTgyNDk1ODkzNDgzMTU5MDg1NzYxNjU4NTY0ODk5NTY3MjgxMDAwNDkwOTM3ODIzMTI2MDY4ODE0NDY3MzY3OTIzMTczMzIzNDAyNTcxMTY0MTYwMzEzOTA0NzUxNDM4MDMyMzI2MzY0NDk3NzYxMTczNzY1NTczNDEwMTkyODk1OTI4ODQyOTUyNDAwMTkxNjI4ODExNDYzNzg0NDMxNzE1NzA2MzkwNDcxMzgxMDc0NjgzNzkyMjU3MTMyOTYxNjI0NDEyNDE3MDU2ODE2NDU1OTUzMjMxODExNTA3NTc3Mzc3OTc0MDIzMjE0NDA4NDQ1NTQzMzg2NDg2Mjg2NDQ1NTMyMjM3MzEwNzQ0NjUyNDU1MDYzMzI3NTAzNTUzMTIzOTk3Mjc2NTU4In0sICJyX2NyZWRlbnRpYWwiOiBudWxsfSwgInNpZ25hdHVyZV9jb3JyZWN0bmVzc19wcm9vZiI6IHsic2UiOiAiMjQxODk4MTI0NDYzOTI4NjM1MDQ5NzI3NTk5Mzg5Mjg3MDg1MDI4NTg3NTkyNTg0OTc0NjcxNDIwMTg3Nzg1MDI2MDg4ODU0NzExODE1MjU5MzE3MDMzMTYyOTI3MjIxMjQ3NzMyOTgyNDE0MzE1NTE1ODI5MTA1MzI3MDUxNjg3Mzc0NDU4MTk3NjIwODI5NDY3OTAzMDUxMDIyOTAyNDk4OTU4MzM2Nzc3ODY3Mzc1ODk2Mzg2Njg4NjIyNzU3NzQwODg5NzQxMzg4ODcyOTAzMjQzNzEyMDg4MjE4MjkwMzQ5NzkwNzUzNDg1MjYyOTg4MDUxNzYyNTk2Nzk0MDk3OTU4MTYyNTQwMzM0NjMxMzgzNzM2NDU4MjEyNDYzMDc1MzYyMzI5NTg0NzY1NTE5NDcyNzg0NDE3MTQwNzQyMTg5MzYzNzcwMjk0NjcwMzA1NzAyNTI4NDA5MzUxMzI4NDI4ODY5NTg1MTM0OTI4OTE2Njg0MjQxMDgxODIyNzYzMDY2MjA3NzgxOTM1NDEyODExMjI2OTYxOTE4NTA5OTMyOTAzODIwMzU1NzA3MjE2NTA0NTc2Mzc5MjQ0ODk0Mzk4MzUwMzE5MTczNjcyMTcxMzUwNDI4ODM2NTAyNjMzNzY4ODE0MzkzNzU4MTUzMDgyMjQ4NjE1Nzc5MTk3Mjg3OTc2MTY4OTMzMzM1ODU2NzI1NzQ2MzM1NzczMzg0MDcwMDY5MzIxMjY2NzAwNTg5OTI2NjUwODk1OTk1NTg3ODg1NjM1OTAxMzQxMTA2NTczMjMzMDIxNzExNTUyMTM5MTc0NjgiLCAiYyI6ICI2MjA1MzIyODY5Mzg2NjQwMTkzNzUyNjE1NTUwMTM2NDU0NzMxNzA4NjkyNjkxMTYzMDg0OTI3NTc1NzY2MTMzMjc0MTUyOTYyOTAwMiJ9LCAicmV2X3JlZyI6IG51bGwsICJ3aXRuZXNzIjogbnVsbH0="
        }
      }
    ],
    "comment": "Issuing credential, exchange 989f77ef-5d87-4252-bb70-aa417dfcf7f2"
  }`

func TestOffer_ReadJSON(t *testing.T) {
	ipl := aries.PayloadCreator.NewFromData([]byte(offerData))

	if ipl.ID() != "3dc323d4-17ec-4a4a-9d3a-uc903e94d253b" {
		t.Errorf("id (%v) not match", ipl.ID())
	}

	offer, ok := ipl.MsgHdr().FieldObj().(*Offer)
	assert.True(t, ok)

	oa, err := OfferAttach(offer)
	assert.NoError(t, err)
	assert.GreaterOrEqual(t, len(oa), 1)

	ipl = aries.PayloadCreator.NewFromData([]byte(offerDataDIDCommOrg))

	if ipl.ID() != "3dc323d4-17ec-4a4a-9d3a-uc903e94d253b" {
		t.Errorf("id (%v) not match", ipl.ID())
	}

	offer2, ok := ipl.MsgHdr().FieldObj().(*Offer)
	assert.True(t, ok)

	oa2, err := OfferAttach(offer2)
	assert.NoError(t, err)
	assert.GreaterOrEqual(t, len(oa2), 1)
}

func TestRequest_ReadJSON(t *testing.T) {
	ipl := aries.PayloadCreator.NewFromData([]byte(requestData))

	assert.Equal(t, "dfd5dcaa-67f4-4c84-aed7-767cf7291f1e", ipl.ID())
	assert.Equal(t, "3dc323d4-17ec-4a4a-9d3a-c903e94d253b", ipl.ThreadID())

	msg, ok := ipl.MsgHdr().FieldObj().(*Request)
	assert.True(t, ok)

	attach, err := RequestAttach(msg)
	assert.NoError(t, err)
	assert.GreaterOrEqual(t, len(attach), 1)

	ipl2 := aries.PayloadCreator.NewFromData([]byte(requestDataDIDOrg))

	assert.Equal(t, "dfd5dcaa-67f4-4c84-aed7-767cf7291f1e", ipl2.ID())
	assert.Equal(t, "3dc323d4-17ec-4a4a-9d3a-c903e94d253b", ipl2.ThreadID())

	msg2, ok := ipl.MsgHdr().FieldObj().(*Request)
	assert.True(t, ok)

	attach2, err := RequestAttach(msg2)
	assert.NoError(t, err)
	assert.GreaterOrEqual(t, len(attach2), 1)
}

func TestIssue_ReadJSON(t *testing.T) {
	ipl := aries.PayloadCreator.NewFromData([]byte(issueData))

	assert.Equal(t, "ac8120e9-ee55-4f64-a385-5e429916a1e1", ipl.ID())
	assert.Equal(t, "3dc323d4-17ec-4a4a-9d3a-c903e94d253b", ipl.ThreadID())

	msg, ok := ipl.MsgHdr().FieldObj().(*Issue)
	assert.True(t, ok)

	attach, err := CredentialAttach(msg)
	assert.NoError(t, err)
	assert.GreaterOrEqual(t, len(attach), 1)

	ipl = aries.PayloadCreator.NewFromData([]byte(issueDataDIDOrg))

	assert.Equal(t, "ac8120e9-ee55-4f64-a385-5e429916a1e1", ipl.ID())
	assert.Equal(t, "3dc323d4-17ec-4a4a-9d3a-c903e94d253b", ipl.ThreadID())

	msg, ok = ipl.MsgHdr().FieldObj().(*Issue)
	assert.True(t, ok)

	attach, err = CredentialAttach(msg)
	assert.NoError(t, err)
	assert.GreaterOrEqual(t, len(attach), 1)
}

func TestIssueCredential_MsgPingPong(t *testing.T) {
	inviteID := "invite id"
	firstMsgID := "prop id"

	prop, pok := aries.MsgCreator.Create(didcomm.MsgInit{
		AID:    firstMsgID,
		Type:   pltype.IssueCredentialPropose,
		Thread: decorator.NewThread(firstMsgID, inviteID),
	}).(*ProposeImpl)
	assert.True(t, pok)

	offer, ook := aries.MsgCreator.Create(didcomm.MsgInit{
		AID:    "offer id",
		Type:   pltype.IssueCredentialOffer,
		Thread: prop.Thread(),
	}).(*OfferImpl)
	assert.True(t, ook)
	assert.Equal(t, offer.Thread().PID, inviteID)
	assert.Equal(t, offer.Thread().ID, firstMsgID)

	pres, presOK := aries.MsgCreator.Create(didcomm.MsgInit{
		AID:    "pres id",
		Type:   pltype.IssueCredentialRequest,
		Thread: offer.Thread(),
	}).(*RequestImpl)
	assert.True(t, presOK)
	assert.Equal(t, pres.Thread().PID, inviteID)
	assert.Equal(t, pres.Thread().ID, firstMsgID)

	issue, iok := aries.MsgCreator.Create(didcomm.MsgInit{
		AID:    "issue id",
		Type:   pltype.IssueCredentialIssue,
		Thread: offer.Thread(),
	}).(*IssueImpl)
	assert.True(t, iok)
	assert.Equal(t, issue.Thread().PID, inviteID)
	assert.Equal(t, issue.Thread().ID, firstMsgID)

}

func TestNewPreviewCredential(t *testing.T) {
	coded := `{"email":{"raw":"name@site.net","encoded":"105946137995126203168177080265064725288488683801335157827153404099229214262953"}}`
	pc0 := NewPreviewCredentialRaw(coded)
	assert.Len(t, pc0.Attributes, 1)
	codedBuild := PreviewCredentialToCodedValues(pc0)
	assert.Equal(t, coded, codedBuild)

	pc := NewPreviewCredential(`[{"name":"TODO","value":"TODO"}]`)
	assert.Len(t, pc.Attributes, 1)

	pc = NewPreviewCredential(`[{"name":"TODO","value":"TODO"},
{"name":"Test2","value":"TODO"}]`)
	assert.Len(t, pc.Attributes, 2)

	s3 := `[{"name":"TODO","value":"TODO"},{"name":"Test2","value":"TODO"},{"name":"Test3","value":"TODO"}]`
	pc = NewPreviewCredential(s3)
	assert.Len(t, pc.Attributes, 3)

	pc.Attributes[0].MimeType = "type"
	pc.Attributes[1].MimeType = "type"
	pc.Attributes[2].MimeType = "type"
	attr3 := PreviewCredentialToValues(pc)
	assert.Equal(t, s3, attr3)
}
